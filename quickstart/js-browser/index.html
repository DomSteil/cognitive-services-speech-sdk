<!DOCTYPE html>
<html>
<head>
    <title>Microsoft Cognitive Service Speech SDK JavaScript Quickstart</title>
    <meta charset="utf-8" />
</head>
<body style="font-family:'Helvetica Neue',Helvetica,Arial,sans-serif; font-size:13px;">
    <div id="warning">
        <h1 style="font-weight:500;">Speech Recognition SpeechSDK not found (speech.sdk.bundle.js missing).</h1>
    </div>

    <!-- <uidiv> -->
    <div id="content" style="display:none">
        <table width="100%">
            <tr>
                <td></td>
                <td>
                    <h1 style="font-weight:500;">Microsoft Cognitive Service Speech SDK JavaScript Quickstart</h1>
                </td>
            </tr>
            <tr>
                <td align="right"><a href="https://docs.microsoft.com/azure/cognitive-services/speech-service/get-started" target="_blank">Subscription</a>:</td>
                <td><input id="subscriptionKey" type="text" size="40" value="subscription"></td>
            </tr>
            <tr>
                <td align="right">Region</td>
                <td><input id="regionKey" type="text" size="40" value="YourSubscriptionServiceRegion"></td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button id="startRecognizeAsyncButton">Start Recognition</button>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <table>
                        <tr>
                            <td>Results:</td>
                        </tr>
                        <tr>
                            <td>
                                <textarea id="phraseDiv" style="display: inline-block;width:500px;height:200px"></textarea>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <!-- </uidiv> -->

    <!-- <speechsdkref> -->
    <!-- SpeechSDK REFERENCE -->
    <!-- TODO replace path with CDN -->
    <script src="speech.sdk.bundle.js"></script>
    <!-- </speechsdkref> -->


    <!-- <quickstartcode> -->
    <!-- SpeechSDK USAGE -->
    <script>
        // On document load resolve the SpeechSDK dependency
        function Initialize(onComplete) {
            if (!!window.SpeechSDK) {
                document.getElementById('content').style.display = 'block';
                document.getElementById('warning').style.display = 'none';
                onComplete(window.SpeechSDK);
            }
        }
    </script>

    <!-- Browser Hooks -->
    <script>
        // status fields and start button in UI
        var phraseDiv;
        var startRecognizeAsyncButton;

        // subscription key for speech services.
        var subscriptionKey, regionKey;

        // TODO: replace the URL with a valid endpoint to retrieve
        //       authorization tokens for your subscription or leave
        //       undefined to use your subscription key.
        var authorizationEndpoint = "token.php";
        var authorizationToken;

        // speech sdk
        var SpeechSDK;
        var recognizer;
        var factory;

        document.addEventListener("DOMContentLoaded", function () {
            startRecognizeAsyncButton = document.getElementById("startRecognizeAsyncButton");

            subscriptionKey = document.getElementById("subscriptionKey");
            regionKey = document.getElementById("regionKey");

            phraseDiv = document.getElementById("phraseDiv");

            startRecognizeAsyncButton.addEventListener("click", function () {
                // if at this point, if we got an authorization token, use the token.
                //  Otherwise use the provided subscription key
                if (authorizationToken) {
                    factory = SpeechSDK.SpeechFactory.fromAuthorizationToken(authorizationToken, regionKey.value);
                } else {
                    if (subscriptionKey.value == "" || subscriptionKey.value == "subscription") {
                        alert("Please enter your Microsoft Cognitive Service Speech subscription key!");
                        return;
                    }

                    factory = SpeechSDK.SpeechFactory.fromSubscription(subscriptionKey.value, regionKey.value);
                }

                phraseDiv.innerHTML = "";

                recognizer = factory.createSpeechRecognizerWithLanguage("en-US");

                // Note: this is how you can process the result directly
                //       rather then subscribing to the Recognized
                //       event
                recognizer.recognizeAsync(
                    function (result) {
                        window.console.log(result);

                        phraseDiv.innerHTML += result.text + "\r\n";

                        recognizer.close();
                        recognizer = undefined;

                        startRecognizeAsyncButton.disabled = false;
                    },
                    function (err) {
                        window.console.log(err);

                        phraseDiv.innerHTML += err;

                        recognizer.close();
                        recognizer = undefined;

                        startRecognizeAsyncButton.disabled = false;
                    });

                startRecognizeAsyncButton.disabled = true;
            });

            subscriptionKey.addEventListener("focus", function () {
               if (subscriptionKey.value == "subscription") {
                   subscriptionKey.value = "";
               }
            });

            subscriptionKey.addEventListener("focusout", function () {
               if (subscriptionKey.value == "") {
                   subscriptionKey.value = "subscription";
               }
            });

            Initialize(function (speechSdk) {
                SpeechSDK = speechSdk;
                startRecognizeAsyncButton.disabled = false;

                if (authorizationEndpoint) {
                    const a = new XMLHttpRequest();
                    a.open("GET", authorizationEndpoint);
                    a.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    a.send("");
                    a.onload = function() {
                        token = this.responseText;
                        subscriptionKey.value = "using authorization token (hit F5 to refresh)";
                        subscriptionKey.disabled = true;
                        authorizationToken = token;
                        console.log("Got an authorization token");
                    }
                }
            });
        });
    </script>
    <!-- </quickstartcode> -->

</body>
</html>
